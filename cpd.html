<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Jun 18, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20130618" />
    <meta http-equiv="Content-Language" content="en" />
    <title>MapDB - CPD Results</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<script src="js/jquery.min.js"></script>
                      
        
<script src="js/donate.js"></script>
                      
        
<script src="js/excanvas.js"></script>
                      
        
<script src="js/js-class.js"></script>
                      
        
<script src="js/bluff.js"></script>
          
            </head>
        <body class="topBarEnabled">
          
    
    
            
    
        
    <a href="http://github.com/JanKotek/MapDB">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                        
                    
                

    <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
                                  <div class="container"><div class="nav-collapse">
            
                
                                                                                <a class="brand" href="index.html"  title="MapDB">

                                
                                                                                                                    <img src="images/logo.png" alt="MapDB" />
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">MapDB <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="index.html"  title="Introduction">Introduction</a>
</li>
                  
                      <li>      <a href="features.html"  title="Features">Features</a>
</li>
                  
                      <li>      <a href="faq.html"  title="Frequently Asked Questions">Frequently Asked Questions</a>
</li>
                  
                      <li>      <a href="credits.html"  title="Credits">Credits</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reports <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li class="dropdown-submenu">
                                      <a href="project-info.html"  title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="index.html"  title="About">About</a>
</li>
                                  <li>      <a href="team-list.html"  title="Project Team">Project Team</a>
</li>
                                  <li>      <a href="dependency-info.html"  title="Dependency Information">Dependency Information</a>
</li>
                                  <li>      <a href="plugins.html"  title="Project Plugins">Project Plugins</a>
</li>
                                  <li>      <a href="integration.html"  title="Continuous Integration">Continuous Integration</a>
</li>
                                  <li>      <a href="issue-tracking.html"  title="Issue Tracking">Issue Tracking</a>
</li>
                                  <li>      <a href="source-repository.html"  title="Source Repository">Source Repository</a>
</li>
                                  <li>      <a href="license.html"  title="Project License">Project License</a>
</li>
                                  <li>      <a href="plugin-management.html"  title="Plugin Management">Plugin Management</a>
</li>
                                  <li>      <a href="distribution-management.html"  title="Distribution Management">Distribution Management</a>
</li>
                                  <li>      <a href="project-summary.html"  title="Project Summary">Project Summary</a>
</li>
                                  <li>      <a href="mail-lists.html"  title="Mailing Lists">Mailing Lists</a>
</li>
                                  <li>      <a href="dependencies.html"  title="Dependencies">Dependencies</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="project-reports.html"  title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="apidocs/index.html"  title="JavaDocs">JavaDocs</a>
</li>
                                  <li>      <a href="surefire-report.html"  title="Surefire Report">Surefire Report</a>
</li>
                                  <li>      <a href="pmd.html"  title="PMD Report">PMD Report</a>
</li>
                                  <li>      <a href="cpd.html"  title="CPD Report">CPD Report</a>
</li>
                                  <li>      <a href="findbugs.html"  title="FindBugs Report">FindBugs Report</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                  </ul>
          
                      <form id="search-form" action="http://www.google.com/search" method="get"  class="navbar-search pull-right" >
    
  <input value="www.mapdb.org" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
                                                              
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>MapDB</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2013-06-18</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 0.9.4-SNAPSHOT</li>
                      
                
            
      
                            </ul>
      </div>

      
                
        <div id="bodyColumn" >
                                  
            <div class="section"><h2>CPD Results<a name="CPD_Results"></a></h2><p>The following document contains the results of PMD's  <a class="externalLink" href="http://pmd.sourceforge.net/cpd.html">CPD</a> 4.3.</p></div><div class="section"><h2>Duplications<a name="Duplications"></a></h2><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org/mapdb/Fun.java</td><td>127</td></tr><tr class="a"><td>org/mapdb/Fun.java</td><td>200</td></tr><tr class="b"><td colspan='2'><div><pre>            final Tuple3 oo = (Tuple3) o;
            if(a!=oo.a){
                if(a==null || oo.a==HI) return -1;
                if(a==HI ||  oo.a==null) return 1;

                final int c = ((Comparable)a).compareTo(oo.a);
                if(c!=0) return c;
            }

            if(b!=oo.b){
                if(b==null || oo.b==HI) return -1;
                if(b==HI || oo.b==null) return 1;

                final int i = ((Comparable)b).compareTo(oo.b);
                if(i!=0) return i;
            }

            if(c!=oo.c){
                if(c==null || oo.c==HI) return -1;
                if(c==HI || oo.c==null) return 1;

                final int i = ((Comparable)c).compareTo(oo.c);
                if(i!=0) return i;
            }</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org/mapdb/StoreWAL.java</td><td>232</td></tr><tr class="a"><td>org/mapdb/StoreWAL.java</td><td>292</td></tr><tr class="b"><td colspan='2'><div><pre>            final long[] physPos;
            final long[] logPos;

            long indexVal = 0;
            long[] linkedRecords = getLinkedRecordsFromLog(ioRecid);
            if(linkedRecords==null){
                indexVal = index.getLong(ioRecid);
                linkedRecords = getLinkedRecordsIndexVals(indexVal);
            }

            structuralLock.lock();
            try{
                openLogIfNeeded();

                //free first record pointed from indexVal
                if(indexVal!=0)
                    freePhysPut(indexVal);

                //if there are more linked records, free those as well
                if(linkedRecords!=null){
                    for(int i=0; i&lt;linkedRecords.length &amp;&amp;linkedRecords[i]!=0;i++){
                        freePhysPut(linkedRecords[i]);
                    }
                }


                //first get space in phys
                physPos = physAllocate(out.pos,false);
                //now get space in log
                logPos = logAllocate(physPos);

            }finally{
                structuralLock.unlock();
            }

            //write data into log
            walIndexVal((logPos[0]&amp;MASK_OFFSET) - 1-8-8-1-8, ioRecid, physPos[0]);
            walPhysArray(out, physPos, logPos);

            modified.put(ioRecid,logPos);
        }finally{</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org/mapdb/BTreeMap.java</td><td>2231</td></tr><tr class="a"><td>org/mapdb/HTreeMap.java</td><td>1193</td></tr><tr class="b"><td colspan='2'><div><pre>        return new BTreeMap&lt;K, V&gt;(snapshot,treeRecid, defaultSerializer);
    }



    protected final Object modListenersLock = new Object();
    protected Bind.MapListener&lt;K,V&gt;[] modListeners = new Bind.MapListener[0];

    @Override
    public void addModificationListener(Bind.MapListener&lt;K,V&gt; listener) {
        synchronized (modListenersLock){
            Bind.MapListener&lt;K,V&gt;[] modListeners2 =
                    Arrays.copyOf(modListeners,modListeners.length+1);
            modListeners2[modListeners2.length-1] = listener;
            modListeners = modListeners2;
        }

    }

    @Override
    public void removeModificationListener(Bind.MapListener&lt;K,V&gt; listener) {
        synchronized (modListenersLock){
            for(int i=0;i&lt;modListeners.length;i++){
                if(modListeners[i]==listener) modListeners[i]=null;
            }
        }
    }

    protected void notify(K key, V oldValue, V newValue) {</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org/mapdb/BTreeMap.java</td><td>1366</td></tr><tr class="a"><td>org/mapdb/BTreeMap.java</td><td>1399</td></tr><tr class="b"><td colspan='2'><div><pre>    protected Entry&lt;K, V&gt; findLarger(K key, boolean inclusive) {
        if(key==null) return null;
        K v = (K) key;
        final long rootRecid = engine.get(rootRecidRef, Serializer.LONG_SERIALIZER);
        long current = rootRecid;
        BNode A = engine.get(current, nodeSerializer);

        //dive until  leaf
        while(!A.isLeaf()){
            current = nextDir((DirNode) A, v);
            A = engine.get(current, nodeSerializer);
        }

        //now at leaf level
        LeafNode leaf = (LeafNode) A;
        //follow link until first matching node is found
        final int comp = inclusive?1:0;
        while(true){
            for(int i=1;i&lt;leaf.keys.length-1;i++){
                if(leaf.keys[i]==null) continue;

                if(comparator.compare(key, leaf.keys[i])&lt;comp){
                    return makeEntry(leaf.keys[i], hasValues?valExpand(leaf.vals[i]):Utils.EMPTY_STRING);</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org/mapdb/Fun.java</td><td>70</td></tr><tr class="a"><td>org/mapdb/Fun.java</td><td>127</td></tr><tr class="b"><td>org/mapdb/Fun.java</td><td>200</td></tr><tr class="a"><td colspan='2'><div><pre>            final Tuple2 oo = (Tuple2) o;
            if(a!=oo.a){
                if(a==null || oo.a==HI) return -1;
                if(a==HI || oo.a==null) return 1;

                final int c = ((Comparable)a).compareTo(oo.a);
                if(c!=0) return c;
            }

            if(b!=oo.b){
                if(b==null || oo.b==HI) return -1;
                if(b==HI || oo.b==null) return 1;

                final int i = ((Comparable)b).compareTo(oo.b);
                if(i!=0) return i;
            }</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org/mapdb/BTreeMap.java</td><td>1631</td></tr><tr class="b"><td>org/mapdb/BTreeMap.java</td><td>1776</td></tr><tr class="a"><td colspan='2'><div><pre>                return ((BTreeMap.SubMap&lt;E,Object&gt;)m).keyIterator();
        }
        @Override
		public boolean equals(Object o) {
            if (o == this)
                return true;
            if (!(o instanceof Set))
                return false;
            Collection&lt;?&gt; c = (Collection&lt;?&gt;) o;
            try {
                return containsAll(c) &amp;&amp; c.containsAll(this);
            } catch (ClassCastException unused)   {
                return false;
            } catch (NullPointerException unused) {
                return false;
            }
        }
        @Override
		public Object[] toArray()     { return toList(this).toArray();  }
        @Override
		public &lt;T&gt; T[] toArray(T[] a) { return toList(this).toArray(a); }</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org/mapdb/StoreDirect.java</td><td>275</td></tr><tr class="b"><td>org/mapdb/StoreWAL.java</td><td>271</td></tr><tr class="a"><td colspan='2'><div><pre>            put2(out, ioRecid, indexVals);
        }finally{
            lock.unlock();
        }
        recycledDataOuts.offer(out);
    }

    @Override
    public &lt;A&gt; boolean compareAndSwap(long recid, A expectedOldValue, A newValue, Serializer&lt;A&gt; serializer) {
        final long ioRecid = IO_USER_START + recid*8;
        final Lock lock  = locks[Utils.longHash(recid)&amp;Utils.LOCK_MASK].writeLock();
        lock.lock();

        DataOutput2 out;
        try{
            /*
             * deserialize old value
             */

            A oldVal = get2(ioRecid,serializer);

            /*
             * compare oldValue and expected
             */
            if((oldVal == null &amp;&amp; expectedOldValue!=null) || (oldVal!=null &amp;&amp; !oldVal.equals(expectedOldValue)))
                return false;

            /*
             * write new value
             */
             out = serialize(newValue, serializer);</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org/mapdb/LongConcurrentLRUMap.java</td><td>653</td></tr><tr class="b"><td>org/mapdb/LongConcurrentLRUMap.java</td><td>681</td></tr><tr class="a"><td colspan='2'><div><pre>  public Map&lt;Long,V&gt; getOldestAccessedItems(int n) {
    Map&lt;Long,V&gt; result = new LinkedHashMap&lt;Long,V&gt;();
    if (n &lt;= 0)
      return result;
    TreeSet&lt;CacheEntry&lt;V&gt;&gt; tree = new TreeSet&lt;CacheEntry&lt;V&gt;&gt;();
    markAndSweepLock.lock();
    try {
        for( Iterator&lt;CacheEntry&lt;V&gt;&gt; iter = map.valuesIterator(); iter.hasNext();){
        CacheEntry&lt;V&gt; ce = iter.next();
        ce.lastAccessedCopy = ce.lastAccessed;
        if (tree.size() &lt; n) {
          tree.add(ce);
        } else {
          if (ce.lastAccessedCopy &lt; tree.first().lastAccessedCopy) {</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org/mapdb/EncryptionXTEA.java</td><td>72</td></tr><tr class="b"><td>org/mapdb/EncryptionXTEA.java</td><td>95</td></tr><tr class="a"><td colspan='2'><div><pre>    private void encryptBlock(byte[] in, byte[] out, int off) {
        int y = (in[off] &lt;&lt; 24) | ((in[off+1] &amp; 255) &lt;&lt; 16) | ((in[off+2] &amp; 255) &lt;&lt; 8) | (in[off+3] &amp; 255);
        int z = (in[off+4] &lt;&lt; 24) | ((in[off+5] &amp; 255) &lt;&lt; 16) | ((in[off+6] &amp; 255) &lt;&lt; 8) | (in[off+7] &amp; 255);</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org/mapdb/EncryptionXTEA.java</td><td>91</td></tr><tr class="b"><td>org/mapdb/EncryptionXTEA.java</td><td>114</td></tr><tr class="a"><td colspan='2'><div><pre>        out[off] = (byte) (y &gt;&gt; 24); out[off+1] = (byte) (y &gt;&gt; 16); out[off+2] = (byte) (y &gt;&gt; 8); out[off+3] = (byte) y;
        out[off+4] = (byte) (z &gt;&gt; 24); out[off+5] = (byte) (z &gt;&gt; 16); out[off+6] = (byte) (z &gt;&gt; 8); out[off+7] = (byte) z;
    }

    private void decryptBlock(byte[] in, byte[] out, int off) {</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org/mapdb/BTreeMap.java</td><td>1238</td></tr><tr class="b"><td>org/mapdb/BTreeMap.java</td><td>2030</td></tr><tr class="a"><td colspan='2'><div><pre>    }


    @Override
    public Entry&lt;K, V&gt; pollFirstEntry() {
        while(true){
            Entry&lt;K, V&gt; e = firstEntry();
            if(e==null || remove(e.getKey(),e.getValue())){
                return e;
            }
        }
    }

    @Override
    public Entry&lt;K, V&gt; pollLastEntry() {
        while(true){
            Entry&lt;K, V&gt; e = lastEntry();
            if(e==null || remove(e.getKey(),e.getValue())){
                return e;
            }
        }
    }</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org/mapdb/StoreDirect.java</td><td>253</td></tr><tr class="b"><td>org/mapdb/StoreDirect.java</td><td>307</td></tr><tr class="a"><td colspan='2'><div><pre>            long indexVal = index.getLong(ioRecid);
            long[] indexVals = spaceReclaimTrack ? getLinkedRecordsIndexVals(indexVal) : null;
            structuralLock.lock();
            try{

                if(spaceReclaimTrack){
                    //free first record pointed from indexVal
                    freePhysPut(indexVal);

                    //if there are more linked records, free those as well
                    if(indexVals!=null){
                        for(int i=0;i&lt;indexVals.length &amp;&amp; indexVals[i]!=0;i++){
                            freePhysPut(indexVals[i]);
                        }
                    }
                }

                indexVals = physAllocate(out.pos,true);
            }finally {
                structuralLock.unlock();
            }

            put2(out, ioRecid, indexVals);
        }finally{</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org/mapdb/BTreeKeySerializer.java</td><td>455</td></tr><tr class="b"><td>org/mapdb/BTreeKeySerializer.java</td><td>626</td></tr><tr class="a"><td colspan='2'><div><pre>            Tuple3KeySerializer that = (Tuple3KeySerializer) o;

            if (aComparator != null ? !aComparator.equals(that.aComparator) : that.aComparator != null) return false;
            if (aSerializer != null ? !aSerializer.equals(that.aSerializer) : that.aSerializer != null) return false;
            if (bComparator != null ? !bComparator.equals(that.bComparator) : that.bComparator != null) return false;
            if (bSerializer != null ? !bSerializer.equals(that.bSerializer) : that.bSerializer != null) return false;
            if (cSerializer != null ? !cSerializer.equals(that.cSerializer) : that.cSerializer != null) return false;</pre></div></td></tr></table></div>
                  </div>
          </div>

    <hr/>

    <footer>
            <div class="container">
              <div class="row span12">Copyright &copy;                   2013.
          All Rights Reserved.      
            
      </div>

        
                <p id="poweredBy" class="pull-right">
                          <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
              </p>
        
                </div>
    </footer>
  </body>
</html>
